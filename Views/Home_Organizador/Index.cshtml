<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emissor de Certificados</title>
    <link rel="stylesheet" href="/css/Home_Organizador.css">
    <script src="~/js/Home_Organizador.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <img id="logo" src="/logoemescam.png">
</head>
<body>
    <div class="cartao-menu">
        <div style="font-size:larger">Bem-Vindo! "ORGANIZADOR"</div>
        <form>
            <div>
                <a class="nav-link text-dark" href="#" onclick="mostrarCard('meus-eventos')">Meus Eventos</a>
                <a class="nav-link text-dark" href="#" onclick="mostrarCard('buscar-pessoas')">Buscar Pessoas</a>
                <a id="sair-link" class="nav-link text-dark" asp-action="Login" asp-controller="Organizador">Sair</a>
            </div>
        </form>

        <!--CADASTRAR EVENTO-->
        <div id="card-evento" class="card">
            <h3>Novo Evento</h3>
            <hr>
            <!-- Input para o nome do evento -->
            <input type="text" id="nomeEvento" placeholder="Nome do Evento">
            <hr>
            <!--Aqui preenchem os dados-->
            <div class="dados-form">
                <div id="divDados">
                    <input type="text" id="inputNome" placeholder="Nome">
                    <input type="text" id="inputCPF" placeholder="CPF">
                    <input type="text" id="inputEmail1" placeholder="Email">
                    <input type="text" id="tipoPessoa" placeholder="Tipo Pessoa">
                </div>
                <textarea id="textareaTexto" placeholder="Texto"></textarea>
            </div>
            <button id="botaoAcao" onclick="atualizarDados()">Adicionar Dados</button>
            <hr>
           
            <!--Tabela que será preenchida-->
            <div class="tabela-container">
                <table id="tabela" class="display">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>CPF</th>
                            <th>Email</th>
                            <th>Tipo Pessoa</th>
                            <th>Texto</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="upload-container">
                <!-- Botão de importar EXCEL -->
                <input type="file" id="excelFile" accept=".xlsx">
                <button onclick="importarExcel()">Importar Participantes</button>
                <span style="margin-right: 10%;"></span>
                <input type="file" id="arteCertificadoFile" accept=".jpeg, .jpg">
            </div>
            <button id="CadastrarEvento" onclick="cadastrarEvento()">Cadastrar Evento</button>
        </div>

        <div id="card-meus-eventos" class="card">
            <h4>Meus Eventos</h4>
            <!-- Botão de "Adicionar Evento" -->
            <button class="botao-adicionar" onclick="exibirFormularioAdicionar()">Adicionar Evento</button>
            <!-- Campo de pesquisa -->
            <input type="text" id="campo-pesquisa" placeholder="Pesquisar eventos...">
            <hr>
            <div class="tabela-eventos">
                <!-- Tabela de eventos -->
                <table>
                    <thead>
                        <tr>
                            <th>Código do Evento</th>
                            <th>Nome do Evento</th>
                            <th>Imagem do Certificado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="eventos-tbody">
                        <!-- As linhas serão preenchidas dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="card-buscar-pessoas" class="card">
            Informações sobre Buscar Pessoas
        </div>
    </div>

    <script>
        window.onload = function () {
            mostrarCard('meus-eventos');
            preencherTabelaEventos();
        };

        function mostrarCard(id) {
            var cards = document.querySelectorAll('.card');
            cards.forEach(function (card) {
                card.style.display = 'none';
            });

            var cardToShow = document.getElementById('card-' + id);
            if (cardToShow) {
                cardToShow.style.display = 'block';
            }
        }

        function exibirFormularioAdicionar() {
            var cards = document.querySelectorAll('.card');
            cards.forEach(function (card) {
                card.style.display = 'none';
            });

            var cardNovoEvento = document.getElementById('card-evento');
            if (cardNovoEvento) {
                cardNovoEvento.style.display = 'block';
                cardNovoEvento.scrollIntoView({ behavior: 'smooth' });
            }
        }

       //AQUI ESTAO OS EVENTOS CADASTRADOS
        var eventos = [
            { id: 20376, nome: "CAAL 2020 - CAAL Convida: SUS, História e Desafios", data: "09/11/2020", imagem: "path/to/image1.png" },
            { id: 20373, nome: "CAAL 2020 - CAAL Convida: Crises Sanitárias e Negacionismo", data: "09/11/2020", imagem: "path/to/image2.png" },
            { id: 20372, nome: "CAAL 2020 - CAAL Convida: Efeito Werther e Suicídio", data: "09/11/2020", imagem: "path/to/image3.png" }
        ];

        function preencherTabelaEventos() {
            var tabelaEventos = document.getElementById('eventos-tbody');
            tabelaEventos.innerHTML = '';

            eventos.forEach(function (evento) {
                var novaLinha = tabelaEventos.insertRow();

                var celulaCodigo = novaLinha.insertCell(0);
                celulaCodigo.textContent = evento.id;

                var celulaNome = novaLinha.insertCell(1);
                celulaNome.textContent = evento.nome;

                var celulaImagem = novaLinha.insertCell(2);
                var img = document.createElement('img');
                img.src = evento.imagem;
                img.style.width = '60px';
                img.style.cursor = 'pointer';
                img.onclick = function () {
                    window.open(evento.imagem);
                };
                celulaImagem.appendChild(img);

                var celulaAcoes = novaLinha.insertCell(3);

                var botaoEmitir = document.createElement('button');
                botaoEmitir.textContent = 'Emitir certificado';
                botaoEmitir.className = 'btn btn-emitir'; // Classe para estilizar
                botaoEmitir.onclick = function () {
                    emitirCertificado(evento.nome);
                };
                celulaAcoes.appendChild(botaoEmitir);

                var botaoAtualizar = document.createElement('button');
                botaoAtualizar.textContent = 'Atualizar';
                botaoAtualizar.className = 'btn btn-atualizar'; // Classe para estilizar
                botaoAtualizar.onclick = function () {
                    atualizarEvento(evento.nome);
                };
                celulaAcoes.appendChild(botaoAtualizar);
            });
        }

        function emitirCertificado(nome) {
            alert('Emitir certificado para: ' + nome);
            // Lógica para emitir certificado
        }

        function atualizarEvento(nome) {
            alert('Atualizar evento: ' + nome);
            // Lógica para atualizar evento
        }

        var modoAdicionar = true;
        var linhaEditavel;

        function adicionarBotoesLinha(linha) {
            var colunaAcoes = linha.insertCell(-1);
            var botaoExcluir = document.createElement("button");
            botaoExcluir.textContent = "Excluir";
            botaoExcluir.onclick = function () {
                excluirLinha(linha);
            };
            colunaAcoes.appendChild(botaoExcluir);

            var botaoAtualizar = document.createElement("button");
            botaoAtualizar.textContent = "Atualizar";
            botaoAtualizar.onclick = function () {
                carregarDadosParaEditar(linha);
            };
            colunaAcoes.appendChild(botaoAtualizar);
        }

        function atualizarDados() {
            if (modoAdicionar) {
                var tabela = document.getElementById("tabela");
                var nome = document.getElementById("inputNome").value;
                var cpf = document.getElementById("inputCPF").value;
                var email = document.getElementById("inputEmail1").value;
                var tipoPessoa = document.getElementById("tipoPessoa").value;
                var texto = document.getElementById("textareaTexto").value;

                if (nome === "" || cpf === "" || email === "" || tipoPessoa === "" || texto === "") {
                    alert("Por favor, preencha todos os campos.");
                    return;
                }

                var novaLinha = tabela.insertRow(-1);
                var celulaNome = novaLinha.insertCell(0);
                var celulaCPF = novaLinha.insertCell(1);
                var celulaEmail = novaLinha.insertCell(2);
                var celulaTipoPessoa = novaLinha.insertCell(3);
                var celulaTexto = novaLinha.insertCell(4);

                celulaNome.innerHTML = nome;
                celulaCPF.innerHTML = cpf;
                celulaEmail.innerHTML = email;
                celulaTipoPessoa.innerHTML = tipoPessoa;
                celulaTexto.innerHTML = texto;

                adicionarBotoesLinha(novaLinha);
                limparCampos();
            } else {
                var celulas = linhaEditavel.getElementsByTagName("td");
                celulas[0].innerHTML = document.getElementById("inputNome").value;
                celulas[1].innerHTML = document.getElementById("inputCPF").value;
                celulas[2].innerHTML = document.getElementById("inputEmail1").value;
                celulas[3].innerHTML = document.getElementById("tipoPessoa").value;
                celulas[4].innerHTML = document.getElementById("textareaTexto").value;
                alternarModo();
            }
        }

        function excluirLinha(linha) {
            var index = linha.rowIndex;
            document.getElementById("tabela").deleteRow(index);
        }

        function carregarDadosParaEditar(linha) {
            var celulas = linha.getElementsByTagName("td");
            document.getElementById("inputNome").value = celulas[0].innerHTML;
            document.getElementById("inputCPF").value = celulas[1].innerHTML;
            document.getElementById("inputEmail1").value = celulas[2].innerHTML;
            document.getElementById("tipoPessoa").value = celulas[3].innerHTML;
            document.getElementById("textareaTexto").value = celulas[4].innerHTML;

            linhaEditavel = linha;
            alternarModo();
        }

        function alternarModo() {
            modoAdicionar = !modoAdicionar;
            var botaoAcao = document.getElementById("botaoAcao");
            botaoAcao.textContent = modoAdicionar ? "Adicionar Dados" : "Atualizar Dados";
        }

        function limparCampos() {
            document.getElementById("inputNome").value = "";
            document.getElementById("inputCPF").value = "";
            document.getElementById("inputEmail1").value = "";
            document.getElementById("tipoPessoa").value = "";
            document.getElementById("textareaTexto").value = "";
        }

        function importarExcel() {
            var input = document.getElementById('excelFile');
            if (!input.files || input.files.length === 0) {
                alert('Por favor, selecione um arquivo Excel.');
                return;
            }

            var file = input.files[0];
            var reader = new FileReader();

            reader.onload = function (e) {
                var data = new Uint8Array(e.target.result);
                var workbook = XLSX.read(data, { type: 'array' });
                var sheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[sheetName];

                var expectedColumns = ['NOME_PESSOA', 'CPF_PESSOA', 'EMAIL_PESSOA', 'TIPO_PESSOA', 'TEXTO'];
                var headerRow = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: 'A1:E1' })[0];
                var isValidModel = expectedColumns.every(function (col, index) {
                    return headerRow[index] === col;
                });

                if (!isValidModel) {
                    alert('O modelo da planilha selecionada está incorreto.');
                    return;
                }

                var table = document.getElementById('tabela').getElementsByTagName('tbody')[0];
                var rows = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: 1 });

                rows.forEach(function (row, rowIndex) {
                    var newRow = table.insertRow(-1);
                    row.forEach(function (cellContent) {
                        var cell = newRow.insertCell();
                        cell.textContent = cellContent;
                    });
                    if (rowIndex < rows.length - 1) {
                        adicionarBotoesLinha(newRow);
                    }
                });
            };
            reader.readAsArrayBuffer(file);
        }

        function cadastrarEvento() {
            var nomeEvento = document.getElementById('nomeEvento').value;
            if (nomeEvento.trim() === '') {
                alert('Por favor, insira o nome do evento.');
                return;
            }

            var tabelaEventos = document.getElementById('eventos-tbody');
            var novaLinha = tabelaEventos.insertRow(-1);

            var celulaCodigo = novaLinha.insertCell(0);
            celulaCodigo.textContent = eventos.length + 1; // Código do evento (pode ser incrementado ou gerado conforme necessário)

            var celulaNome = novaLinha.insertCell(1);
            celulaNome.textContent = nomeEvento;

            var celulaPessoas = novaLinha.insertCell(2);
            celulaPessoas.textContent = document.getElementById('tabela').rows.length - 1; // Número de pessoas

            var celulaImagem = novaLinha.insertCell(3);
            var imgCertificado = document.createElement('img');
            var certificadoFile = document.getElementById('arteCertificadoFile').files[0];
            if (certificadoFile) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    imgCertificado.src = e.target.result;
                    imgCertificado.style.width = '60px';
                    celulaImagem.appendChild(imgCertificado);
                };
                reader.readAsDataURL(certificadoFile);
            } else {
                imgCertificado.src = '';
                celulaImagem.appendChild(imgCertificado);
            }

            var celulaAcoes = novaLinha.insertCell(4);
            var botaoAtualizar = document.createElement('button');
            botaoAtualizar.textContent = 'Atualizar';
            botaoAtualizar.className = 'btn btn-atualizar'; // Classe para estilizar
            botaoAtualizar.onclick = function () {
                atualizarEvento(nomeEvento);
            };
            celulaAcoes.appendChild(botaoAtualizar);

            var botaoEmitir = document.createElement('button');
            botaoEmitir.textContent = 'Emitir certificado';
            botaoEmitir.className = 'btn btn-emitir'; // Classe para estilizar
            botaoEmitir.onclick = function () {
                emitirCertificado(nomeEvento);
            };
            celulaAcoes.appendChild(botaoEmitir);

            // Adiciona o novo evento à lista de eventos
            eventos.push({ id: eventos.length + 1, nome: nomeEvento, data: new Date().toLocaleDateString(), imagem: imgCertificado.src });

            // Envia os dados do evento para o backend
            enviarDadosEvento();
        }

        function enviarDadosEvento() {
            var nomeEvento = document.getElementById('nomeEvento').value;
            var arquivoCertificado = document.getElementById('arteCertificadoFile').files[0];
            var tabela = document.getElementById('tabela');
            var dadosTabela = [];
            var linhas = tabela.getElementsByTagName('tr');

            for (var i = 1; i < linhas.length; i++) {
                var linha = linhas[i];
                var celulas = linha.getElementsByTagName('td');
                var dadosLinha = [];

                for (var j = 0; j < celulas.length - 1; j++) {
                    dadosLinha.push(celulas[j].textContent);
                }

                dadosTabela.push(dadosLinha);
            }

            var formData = new FormData();
            formData.append('Nome', nomeEvento);
            formData.append('ImagemCertificado', arquivoCertificado);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/Home_Organizador/NovoEvento');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    alert('Evento cadastrado com sucesso!');
                    window.location.href = '/Home_Organizador/Index';
                } else {
                    alert('Erro ao cadastrar o evento. Por favor, tente novamente.');
                }
            };
            xhr.send(formData);
        }
    </script>
</body>
</html>

<style>
    #logoEmescam {
    }

    #logo {
        width: 20%;
        position: fixed;
        top: 0%;
        left: 11%;
        transform: translateX(-50%);
        margin-top: 0;
        text-align: center;
    }

    body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #14086d;
        font-family: Arial, sans-serif;
    }

    .cartao-menu {
        background-color: rgba(250, 235, 215, 0.5);
        border-radius: 15px;
        box-shadow: 0px 0px 20px 0px rgba(0,0,0,0.2);
        padding: 5%;
        width: 18%;
        max-width: 50%;
        height: 80%;
        text-align: center;
        position: fixed;
        top: 55%;
        left: 10%;
        transform: translate(-50%, -50%);
        background-color: white;
    }

        .cartao-menu a {
            display: block;
            text-decoration: none;
            color: #000;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid transparent;
            transition: color 0.3s, border-color 0.3s;
            border-color: #14086D;
        }

            .cartao-menu a:hover {
                color: #ff0000;
                border-color: #ff0000;
            }

    .card {
        background-color: rgba(250, 235, 215, 0.5);
        padding: 5%;
        width: 442%;
        height: 100%;
        text-align: center;
        position: fixed;
        top: 0;
        left: 103%;
        border-radius: 15px;
        display: none; /* Oculta o card por padrão */
        background-color:white;
    }



    #campo-pesquisa {
        margin-bottom: 10px;
        width: 30%;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .eventos {
        background-color: #fff;
        padding: 10px;
        border: 5px solid #ccc;
        border-radius: 5px;
        width: 1300px;
    }

    .eventos1 {
        background-color: #f9f9f9;
    }

    .botao-adicionar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: deepskyblue;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        position: absolute;
        top: 20px;
        right: 10px;
        overflow: hidden;
    }

        .botao-adicionar::after {
            content: "+";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .botao-adicionar:hover {
            background-color: green;
        }

            .botao-adicionar:hover::after {
                color: black;
            }

    #card-evento {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        background-color:white;
    }

    #divDados {
        float: left;
        margin-left: -3.5%;
    }

    .dados-form {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-between; /* Distribui os itens uniformemente */
        width: 100%;
    }

    #textareaTexto {
        width: 200%;
        height: 150px;
        padding: 10px;
        margin-left: -40px; /* Adiciona um espaço entre o textarea e os inputs */
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }

    .dados-form input,
    .dados-form textarea {
        margin-bottom: 10px; /* Adiciona espaço entre os elementos */
    }

    .dados-form input {
        width: calc(70% - 10px); /* Ajuste conforme necessário */
    }

    .upload-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1%;
    }

        .upload-container input[type="file"] {
            margin-right: 0.3%;
        }



        .upload-container button {
            background-color: green;
            border: none;
            color: white;
            padding: 3px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

            .upload-container button:hover {
                background-color: deepskyblue;
            }


    /* Estilos para a tabela */
    #tabela {
        width: 100%;
        border-collapse: collapse;
        max-height: 300px;
    }

        #tabela th {
            background-color: #f2f2f2; /* Cor de fundo do cabeçalho */
        }

        #tabela tbody tr {
            border-bottom: 1px solid black;
        }

            /* Estilos para linhas alternadas */
            #tabela tbody tr:nth-child(even) {
                background-color: #f9f9f9; /* Cor de fundo para linhas pares */
            }

            #tabela tbody tr:nth-child(odd) {
                background-color: white; /* Cor de fundo para linhas ímpares */
            }

    .tabela-container {
        max-height: 320px;
        overflow-y: auto;
    }

    button.btn {
        padding: 10px 20px;
        font-size: 16px;
        text-transform: uppercase;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
        transition: background-color 0.3s;
    }

    button.btn-emitir {
        background-color: #4CAF50; /* Verde */
    }

        button.btn-emitir:hover {
            background-color: #45a049;
        }

    button.btn-atualizar {
        background-color: #008CBA; /* Azul */
    }

        button.btn-atualizar:hover {
            background-color: #007B9E;
        }
</style>
